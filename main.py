import streamlit as st
import pandas as pd
import os
import json

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙØ­Ø©
st.set_page_config(page_title="BIA601 - Genetic Algorithm Feature Selection", layout="wide")

# Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
st.title("ğŸ§¬ Ù…Ø´Ø±ÙˆØ¹ BIA601 â€” Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¬ÙŠÙ†ÙŠØ©")
st.markdown("""
### ğŸ‘¨â€ğŸ« Ø¥Ø´Ø±Ø§Ù: Ø¯. Ø¹ØµØ§Ù… Ø³Ù„Ù…Ø§Ù†  
**Ø§Ù„Ù…Ø§Ø¯Ø©:** BIA601 â€” Data Mining  
**Ø§Ù„Ù‡Ø¯Ù:** Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¬ÙŠÙ†ÙŠØ© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø«Ù„Ù‰ ÙˆÙ…Ù‚Ø§Ø±Ù†ØªÙ‡Ø§ Ø¨Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©.
""")

OUTPUT_DIR = "outputs"

# ===============================================================
# 1ï¸âƒ£ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯
# ===============================================================
st.header("1ï¸âƒ£ Ù†ØªØ§Ø¦Ø¬ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¬ÙŠÙ†ÙŠØ©")

before_path = os.path.join(OUTPUT_DIR, "before_after.csv")
if os.path.exists(before_path):
    before_after = pd.read_csv(before_path)
    st.dataframe(before_after.style.format({"Score": "{:.4f}"}))
else:
    st.warning("Ù…Ù„Ù before_after.csv ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ ga_core.py Ø£ÙˆÙ„Ø§Ù‹.")

# ===============================================================
# 2ï¸âƒ£ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
# ===============================================================
st.header("2ï¸âƒ£ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© (Full vs GA vs SelectKBest vs RFE)")

comp_path = os.path.join(OUTPUT_DIR, "comparison.csv")
if os.path.exists(comp_path):
    comparison = pd.read_csv(comp_path)
    st.dataframe(comparison.style.format({"CV_Score": "{:.4f}"}))
else:
    st.warning("Ù…Ù„Ù comparison.csv ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.")

# ===============================================================
# 3ï¸âƒ£ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
# ===============================================================
st.header("3ï¸âƒ£ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©")

col1, col2, col3 = st.columns(3)
plots = {
    "ga_evolution.png": "ØªØ·ÙˆØ± Fitness Ø¹Ø¨Ø± Ø§Ù„Ø£Ø¬ÙŠØ§Ù„",
    "score_comparison.png": "Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø·Ø±Ù‚",
    "features_count.png": "Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙŠØ²Ø§Øª ÙÙŠ ÙƒÙ„ Ø·Ø±ÙŠÙ‚Ø©"
}

for (col, (img, caption)) in zip([col1, col2, col3], plots.items()):
    path = os.path.join(OUTPUT_DIR, img)
    with col:
        if os.path.exists(path):
            st.image(path, caption=caption, use_container_width=True)
        else:
            st.warning(f"Ø§Ù„ØµÙˆØ±Ø© {img} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©.")

# ===============================================================
# 4ï¸âƒ£ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¬ÙŠÙ†ÙŠØ©
# ===============================================================
st.header("4ï¸âƒ£ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¬ÙŠÙ†ÙŠØ©")

feat_path = os.path.join(OUTPUT_DIR, "selected_features.json")
if os.path.exists(feat_path):
    with open(feat_path, "r", encoding="utf-8") as f:
        features = json.load(f)
    st.success(f"âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± {len(features)} Ù…ÙŠØ²Ø© Ù…Ù† Ø£ØµÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©.")
    st.write(features)
else:
    st.warning("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù selected_features.json")

# ===============================================================
# 5ï¸âƒ£ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®ØªØ§Ù…ÙŠØ©
# ===============================================================
st.markdown("---")
st.markdown("""
#### ğŸ“˜ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:
- ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¬ÙŠÙ†ÙŠØ© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø«Ù„Ù‰ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØµÙ†ÙŠÙ (Decision Tree Ø£Ùˆ Logistic Regression).
- ØªÙ… Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª ØªÙ‚Ù„ÙŠØ¯ÙŠØ© (RFE, SelectKBest).
- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³ÙˆÙ… ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡Ø§ Ø¢Ù„ÙŠÙ‹Ø§ Ù…Ù† ÙƒÙˆØ¯ `ga_core.py`.
""")

st.caption("Â© 2025 â€” Ù…Ø´Ø±ÙˆØ¹ Ù…Ø§Ø¯Ø© BIA601 | Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ø¥Ø´Ø±Ø§Ù Ø¯. Ø¹ØµØ§Ù… Ø³Ù„Ù…Ø§Ù†")
